<style type="text/css">
	#map {
		height: 600px;
	}
</style>
<div class="col-sm-10 col-sm-offset-2 col-md-11 col-md-offset-1 main">
	<div class="page-header">
		<h3><strong>{{experiment.name}}</strong> - Map</h3>
	</div>
	<alert-messages></alert-messages>
	<div class="row">
		<div class="col-md-9" id="map"></div>
		<div class="col-md-3">
			<h3 class="text-center">Data</h3>
			<div class="form">
				<div class="form-group">
					<label for="latidud" class="col-md-3">Latitud:</label>
					<div class="col-md-9">
						<input type="text" id="latitud" class="form-control" disabled>
					</div>
				</div>
				<div class="form-group">
					<label for="longitud" class="col-md-3">Longitud:</label>
					<div class="col-md-9">
						<input type="text" id="longitud" class="form-control" disabled>
					</div>
				</div>
			</div>
			<h3 class="text-center">Area</h3>
			<div class="form">
				<div class="form-group">
					<label for="altura" class="col-md-3">Altura:</label>
					<div class="col-md-9">
						<input type="number" min="0" id="alto" class="form-control" placeholder="In Meters">
					</div>
				</div>
				<div class="form-group">
					<label for="altura" class="col-md-3">Altura:</label>
					<div class="col-md-9">
						<input type="number" min="0" id="alto" class="form-control" placeholder="In Meters">
					</div>
				</div>
				<div class="text-center">
					<button class="btn btn-primary" onclick="setValues()">Set Values</button>
				</div>
			</div>
		</div>
	</div>
</div>
<script>
function initMap() {
	var marker;
	var latLng;
	var rectangle;
	var map = new google.maps.Map(document.getElementById('map'), {
		scaleControl: true,
		center: {lat: 38.981, lng: -1.856},
		zoom: 8,
		 mapTypeId: google.maps.MapTypeId.TERRAIN
	});

	map.addListener('click', function(e) {
		latLng = e.latLng;
		marker == undefined ? placeMarker(latLng, map) : moveMarker(latLng, map);
		$('#latitud').val(latLng.lat());
		$('#longitud').val(latLng.lng());
	});

	function placeMarker(latLng, map) {
			marker = new google.maps.Marker({
			position: latLng,
			map: map,
			draggable:true,
    		title:"Drag me!"
		});
		map.panTo(latLng);
	
	rectangle = new google.maps.Rectangle({
    strokeColor: '#FF0000',
    strokeOpacity: 0.6,
    strokeWeight: 2,
    fillColor: '#FF0000',
    fillOpacity: 0.2,
	 editable:true,
	 clickable:false,
	 draggable:false,
    map: map,
    bounds: {
      north: latLng.lat()+0.2,
      south: latLng.lat()-0.2,
      east: latLng.lng() + 0.2,
      west: latLng.lng() - 0.2
    }
  });
	 console.log(rectangle.getBounds())
	}

	function moveMarker(latLng, map) {
		console.log(latLng.lat());
		marker.setPosition(latLng);
		map.panTo(latLng);
		rectangle.setBounds({
      north: latLng.lat() + 0.2,
      south: latLng.lat() - 0.2,
      east: latLng.lng() + 0.2,
      west: latLng.lng() - 0.2
    	});
	};

	function distance(lat1, lon1, lat2, lon2) {
		var p = 0.017453292519943295;    // Math.PI / 180
		var c = Math.cos;
		var a = 0.5 - c((lat2 - lat1) * p)/2 + 
					c(lat1 * p) * c(lat2 * p) * 
					(1 - c((lon2 - lon1) * p))/2;

		return 12742 * Math.asin(Math.sqrt(a)); // 2 * R; R = 6371 km
	}

	function displace(lat, lng, dist, theta){
		var EARTH_R = 6371000,
		latG = lat*Math.PI/180,
		lngG = lng*Math.PI/180,
		thetaG = theta*Math.PI/180,
		delta = dist/EARTH_R;

		dstLat = Math.asin(Math.sin(latG) * Math.cos(delta) + Math.cos(latG) * Math.sin(delta) * Math.cos(thetaG));
		dstLng = lngG + Math.atan2(Math.sin(thetaG) * Math.sin(delta) * Math.cos(latG), Math.cos(delta) - Math.sin(latG) * Math.sin(dstLat));
		dstLng = (dstLng + 3.0 * Math.PI) % (2.0 * Math.PI) - Math.PI;

		return [(dstLat*180/Math.PI), (dstLng*180/Math.PI)];
	}

	console.log(displace(38.98503278695909,-1.8505096435546875,5000,0))
}
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDQ4E6LnrDKzrEQtJhXpAY6bl0E9_ewKxY&callback=initMap" async
	defer></script>